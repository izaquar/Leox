<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*ORIGINAL GOODGER + changes; up to line 224 it's standard reST stylesheet
:Author: David Goodger
:Contact: goodger@users.sourceforge.net
:date: $Date: 2006/10/19 13:23:15 $
:version: $Revision: 1.2 $
:copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.
*/

/* EKR 10/19/06 */
/* some browsers require imported rules to precede all rulesets */
@import url(leo_rst.css);
@import url(silver_city.css);

.first {
  margin-top: 0 }

.last {
  margin-bottom: 0 }

a.toc-backref {
  text-decoration: none ;
  color: black }

dd {
  margin-bottom: 0.5em }

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.attention, div.caution, div.danger, div.error, div.hint,
div.important, div.note, div.tip, div.warning, div.admonition {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

div.hint p.admonition-title, div.important p.admonition-title,
div.note p.admonition-title, div.tip p.admonition-title,
div.admonition p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em }

div.footer, div.header {
  font-size: smaller }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 0em 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.line-block {
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;}
  /*background-color: #eeeeee }*/
  /*for some reason i can't overide in an import*/

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.option-argument {
  font-style: italic }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

table {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.citation {
  border-left: solid thin gray ;
  padding-left: 0.5ex }

table.docinfo {
  margin: 2em 4em }

table.footnote {
  border-left: solid thin black ;
  padding-left: 0.5ex }

td, th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

th.docinfo-name, th.field-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap }

h1 tt, h2 tt, h3 tt, h4 tt, h5 tt, h6 tt {
  font-size: 100% }

/*for some reason, the following isn't being overridden by the imports
at the end of this style sheet so I've commented it out*/
/*tt {
  background-color: #eeeeee }*/

ul.auto-toc {
  list-style-type: none }
  
hr { /* EKR */
  width: 100%;
  height: 1pt;
  color: gray;
}



</style>
</head>
<body>
<div class="document">


<!-- rst3: filename: html\debuggers.html -->
<!-- May 27, 2006 -->
<p><a class="reference" href="coloring.html"><img alt="back" src="arrow_lt.gif" /></a> <a class="reference" href="front.html"><img alt="leo" src="leo.gif" /></a> <a class="reference" href="zodb.html"><img alt="next" src="arrow_rt.gif" /></a></p>
<div class="section">
<h1><a class="toc-backref" href="#id1" id="chapter-16-using-external-debuggers" name="chapter-16-using-external-debuggers">Chapter 16: Using External Debuggers</a></h1>
<p><strong>Important</strong>: Support for external debuggers is a work in progress.
The following information is preliminary and may not be completely accurate.
Please feel free to ask questions on <a class="reference" href="http://sourceforge.net/forum/?group_id=3458">Leo's forums</a>.</p>
<p>This chapter discusses debug Leo programs with external debuggers such as <a class="reference" href="http://www.digitalpeers.com/pythondebugger/">winpdb</a> or <a class="reference" href="http://www.python.org/idle/">Idle</a>.</p>
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#chapter-16-using-external-debuggers" id="id1" name="id1">Chapter 16: Using External Debuggers</a><ul>
<li><a class="reference" href="#leo-s-debug-command-and-the-big-debugger-aha" id="id2" name="id2">Leo's debug command and 'the big debugger Aha'</a></li>
<li><a class="reference" href="#settings" id="id3" name="id3">Settings</a></li>
<li><a class="reference" href="#debugging-scripts-so-that-c-g-and-p-are-predefined" id="id4" name="id4">Debugging scripts so that c, g and p are predefined</a></li>
<li><a class="reference" href="#remaining-problems" id="id5" name="id5">Remaining problems</a></li>
</ul>
</li>
</ul>
</div>
<!-- External links... -->
<!-- WARNING: image targets may not have upper case letters! -->
<div class="section">
<h2><a class="toc-backref" href="#id2" id="leo-s-debug-command-and-the-big-debugger-aha" name="leo-s-debug-command-and-the-big-debugger-aha">Leo's debug command and 'the big debugger Aha'</a></h2>
<p>There is a super simple way of embedding winpdb (or any other debugger) into any editor.
Just run winpdb in another process, something like this:</p>
<pre class="literal-block">
import os,sys
pythonDir = g.os_path_dirname(sys.executable)
winPdb = g.os_path_join(pythonDir,'scripts','_winpdb.py')
args = [sys.executable, winPdb, '-t', 'leo.py'] # here leo.py is the program to be debugged.
os.spawnv(os.P_NOWAIT, sys.executable, args)
</pre>
<p>This is so easy it seems almost like a cheat.  But it solves many problems:</p>
<ul class="simple">
<li>No need to commit to any one debugger: substitute your favorite debugger for '_winpdb.py', and modify args as needed.</li>
<li>No need to worry about the interactions between the editor and the debugger: there are none after the debugger starts.  In particular, the debugger can use a separate event loop (or even a different gui) from the editor.</li>
<li>No need (typically) to modify the editor or debugger in <em>any</em> way.  And no need to understand the debugger's code at all.</li>
</ul>
<p>Leo's new debug command generalizes the code above so it passes an arbitrary file (instead of 'leo.py') to an arbitrary debugger.  That's the only debugging code Leo needs, and gives Leo 90% of what I have ever wanted from a debugger.
Furthermore, it allows editing to proceed independently of debugging.
Indeed, even if I were to adapt winpdb so it shows files like Leo does (with an outline and body pane),
I would <em>still</em> want to run the modified winpdb in a separate process.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id3" id="settings" name="settings">Settings</a></h2>
<p>The &#64;string debugger_kind setting controls what debugger the 'Debug Script' script button uses.
Eventually this setting will control what debugger the debug command uses.
At present the only valid values are 'winpdb' and 'idle'.
Support for idle isn't complete yet.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id4" id="debugging-scripts-so-that-c-g-and-p-are-predefined" name="debugging-scripts-so-that-c-g-and-p-are-predefined">Debugging scripts so that c, g and p are predefined</a></h2>
<p>Leo's Execute Script commands predefines the c, g and p symbols.
That is, Leo scripts can, and often do, refer to data <em>within the outline in which the script resides</em>.
Thus, it would be <em>useless</em> to try to run such scripts in a debugger when Leo is not running.</p>
<p>Thus, to use a debugger to debug a Leo script, <strong>you must run Leo itself</strong> from the debugger.
The easy way is to use a batch file that starts the debugger <em>and</em> starts Leo.
Here is the batch file (called dt.bat) to run test.leo using winpdb:</p>
<pre class="literal-block">
cd c:\prog\tigris-cvs\leo\test
c:\python24\python.exe c:\python24\Scripts\_winpdb.py -t ..\src\leo.py test.leo
</pre>
<p>And here is the version of dt.bat that runs test.leo using Idle:</p>
<pre class="literal-block">
cd c:\prog\tigris-cvs\leo\test
c:\python24\python.exe c:\python24\Lib\idlelib\idle.py -d -r c:\python24\Scripts\runLeoTest.py
</pre>
<p>This invokes Idle and tells it to run runLeoTest.py.  runLeoTest.py contains:</p>
<pre class="literal-block">
import os, import sys
sys.path.append(r'c:\prog\tigris-cvs\leo\src')
import leo
leo.run( os.path.join(src,'..','test','test.leo'))
</pre>
<p>After starting the debugger, you simply use the debuggers 'Run' command to run Leo.
Now that Leo is running in the debugger, you can use 'Debug Script' script button to single-step through your script.
<strong>Note</strong>: you must enable the Scripting plugin to use the 'Debug Script' button.</p>
<p>In order to provide access to the c, g and p variables the 'Debug Script' button creates
a helper Python module called leoScriptModule.py.
It is <em>this</em> module that the debugger uses to debug your scripts.
The module contains setup code, followed by the script you want to debug.
For example, suppose your script is:</p>
<pre class="literal-block">
print 'hi'
print c
</pre>
<p>The 'Debug Script' button puts the following in leoScriptModule.py:</p>
<pre class="literal-block">
# A module holding the script to be debugged.
import rpdb2
if rpdb2.g_debugger is not None: # don't hang if the debugger isn't running.
  rpdb2.start_embedded_debugger(pwd=&quot;&quot;,fAllowUnencrypted=True) # Hard breakpoint.
# Predefine c, g and p.
import leoGlobals as g
c = g.app.scriptDict.get(&quot;c&quot;)
p = c.currentPosition()
# Actual script starts here.
print 'hi'
print c
</pre>
<p>It is <em>this</em> code that you will see in the winpdb source window after you hit the 'Debug Script' button.
The present line will be just after the line:</p>
<pre class="literal-block">
rpdb2.start_embedded_debugger(pwd=&quot;&quot;,fAllowUnencrypted=True) # Hard breakpoint.
</pre>
<p>This line is the line that caused a hard breakpoint in the debugger so that you can single-step through your script.
The next lines set up the g, c and p variables:</p>
<pre class="literal-block">
import leoGlobals as g
c = g.app.scriptDict.get(&quot;c&quot;)
p = c.currentPosition()
</pre>
<p>After you single step past these lines you are ready to debug your script.</p>
<p><strong>Summary</strong>: All this may sound complicated, but in practice debugging scripts is easy:</p>
<ul class="simple">
<li>Just run test.leo using dt.bat (instead of t.bat as usual).</li>
<li>Hit the 'Debug Script' script button.</li>
</ul>
<p>That's <em>all</em>.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id5" id="remaining-problems" name="remaining-problems">Remaining problems</a></h2>
<p>A few problems remain:</p>
<ul class="simple">
<li>The code shown above in leoScriptModule.py works only for winpdb.
I haven't figured out how to do this for Idle.</li>
<li>The leoScriptModule hack has exposed a bug in winpdb.
winpdb doesn't update the source listing when leoScriptModule.py changes.
So if you change the script being debugged, winpdb will show you the <em>old</em> version of the script.
It's a strange experience: the debugger will execute the <em>correct</em> code but will show you the <em>incorrect</em> code.</li>
</ul>
<hr class="docutils" />
<p><a class="reference" href="coloring.html"><img alt="back" src="arrow_lt.gif" /></a> <a class="reference" href="front.html"><img alt="leo" src="leo.gif" /></a> <a class="reference" href="zodb.html"><img alt="next" src="arrow_rt.gif" /></a></p>
</div>
</div>
</div>
</body>
</html>
